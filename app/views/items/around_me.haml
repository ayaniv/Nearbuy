.row
  .col-lg-12
    %h1 Around Me

    - Category.all.each do |category|
      = check_box_tag category.name.downcase, category.id, checked:true
      = category.name
    %h3
      We found this around you
.row
  .col-lg-12
    .items
      = render partial:"items", locals:{items: @items}

.row
  .col-lg-12
    .spinner{style:"display:none"}
      = image_tag "ajax-loader.gif"


:coffee
  get_data = ->
    $(".items").empty()
    checkd = $("input[type=checkbox]:checked")
    data = ""
    i = 0

    for category in checkd
      data += $(category).val() + ","

    console.log data
    url = window.location.href

    options =
      url: url
      data:
        categories: data
      dataType: "json"
      complete: (response, status) ->
        results = response.responseJSON
        for item in results
          link = $("<a>").attr("href", "/items/" + item.id).text(item.name)
          header = $('<h1>').append(link)
          div = $("<div>").attr("class", "item").append(header).append("</h1><p>" + item.description + "</p>")
          div.attr("style", "background: url(" + item.image.url.url + "); background-size: 200px 200px; background-size: cover") if item.image != null
          $('.items').append(div)


    $.ajax options

  $("input[type=checkbox]").on "click", get_data
